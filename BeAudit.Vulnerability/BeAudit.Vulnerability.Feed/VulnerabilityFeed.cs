using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Threading.Tasks;
using BeAudit.Package.Interfaces;
using BeAudit.Vulnerability.Feed.Feeds;
using BeAudit.Vulnerability.Interfaces;

namespace BeAudit.Vulnerability.Feed.Factories
{
    public class VulnerabilityFeed
    {
        private static VulnerabilityFeed _instance;
        
        public static VulnerabilityFeed Instance => _instance ?? (_instance = new VulnerabilityFeed());

        private ICollection<IVulnerabilityFeed> feeds;

        private VulnerabilityFeed()
        {
            feeds = new List<IVulnerabilityFeed>
            {
                new OssIndexFeed()
            };
        }

        public IEnumerable<IVulnerability> GetVulnerabilities(IPackageIdentifier packageIdentifier)
        {
            return feeds.Where(feed => feed.SupportedPlatforms.Contains(packageIdentifier.PackageManager))
                .SelectMany(feed => feed.GetVulnerabilities(packageIdentifier).Result);
        }
    }
}